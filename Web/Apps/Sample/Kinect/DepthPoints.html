<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">  
  <!--
    Copyright 2010-2011 Fabric Technologies Inc. All rights reserved.
    -->
    <title>FABRIC - Kinect Depth Points</title> 
    
    <link type="text/css" href="../../../ThirdParty/jQuery/css/fabric/main.css" rel="stylesheet" />
    <link type="text/css" href="../../../ThirdParty/jQuery/css/fabric/jquery-ui-1.8.16.custom.css" rel="stylesheet" />
    
    <script type="text/javascript" src="../../../ThirdParty/jQuery/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="../../../ThirdParty/jQuery/jquery-ui-1.8.16.custom.min.js"></script>

    <script type="text/javascript" src="../../../Core/FABRIC.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Math.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Vec2.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Vec3.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Vec4.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Mat22.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Mat33.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Mat44.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Quat.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Xfo.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/RGBA.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Color.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/Euler.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/OGLShaderProgram.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/OGLTexture2D.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/RT/OGLBuffer.js" charset="utf-8"></script>

    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Geometry.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Primitives.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Lights.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Images.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Materials.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Manipulation.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Kinematics.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Animation.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../SceneGraph/FABRIC.SceneGraph.Kinect.js" charset="utf-8"></script>

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-25833362-1']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(ga, s);
 })();

</script>

    <script type="text/javascript">
$(document).ready(function() {

  var scene = FABRIC.SceneGraph.createScene();
  var viewport = scene.constructNode('Viewport', { windowElement: document.getElementById('FabricContainer') });
viewport.setBackgroundTextureNode(scene.constructNode('Image2D', {
    url: '../BasicDemos/Resources/fabric-demo-gradient.png'
  }));

  // Create a camera to draw the scene from
  var camera = scene.constructNode('TargetCamera', {
      nearDistance: 0.1,
      farDistance: 2000,
      position: new FABRIC.RT.Vec3(1,0,0),
      target: new FABRIC.RT.Vec3(0, -.5, 1.5),
      fovY: Math.degToRad(45.6)
    });

  scene.constructNode('CameraManipulator', { targetNode: camera });
  viewport.setCameraNode(camera);

  $('#loadingDialog').dialog({
    modal: true
  });

  // construct a kinect camera
  var kinect = scene.constructNode('KinectCamera', {supportsDepth: true, supportsColor: true});
  
  // create a geometry node
  var points = kinect.constructPointsNode();
  
  // draw it
  var pointMaterial = scene.constructNode('VertexColorMaterial', {
      prototypeMaterialType: 'PointMaterial',
      pointSize: 6,
    });
  scene.constructNode('Instance', {
    materialNode: pointMaterial,
    geometryNode: points
  });

  scene.animation.play();
  
  $('#play').button({
    text: true,
    icons: {
      primary: 'ui-icon-pause'
    }
  }).click(function() {
    var options;
    if ($(this).text() == 'Play') {
      $(this).button('option', {
        label: 'Pause',
        icons: {
          primary: 'ui-icon-pause'
        }
      });
      scene.animation.play();
    } else {
      $(this).button('option', {
        label: 'Play',
        icons: {
          primary: 'ui-icon-play'
        }
      });
      scene.animation.pause();
    }
  });
  

  FABRIC.appendOnResolveAsyncTaskCallback(function(label, nbRemaining, doneWeight, totalWeight) {
    $('#loadingProgressBar').progressbar({
      value: (1.0-(doneWeight/totalWeight))*100
    });
    if (nbRemaining===0) {
      $('#loadingDialog').dialog('close');
      var errors = scene.getErrors();
      if (errors.length > 0) {
        throw (errors.toString());
      }
      return true;
    }
  });
  
});

// jQuert UI Styling classes
$(document).ready(function() {
  $(".box").addClass("ui-widget");
  $(".box h2").addClass("ui-widget-header ui-corner-all");
  $(".content").addClass("ui-widget-content");
});

</script>

  </head> 
  <body>
    <div id="loadingDialog" title="Loading...">
      <h4 id="loadingDesc">Setting up Kinect Scene...<br>This may take some time.</h4>
      <div id="loadingProgressBar" class="ui-progressbar-value"></div>
    </div>
    <div id="wrapper">
      <div id="editor">
        <div id="viewer">
          <div id="FabricContainer"></div> 
        </div><!--viewer-->
        <div id="sidebar">
          <p class="box">&larr; <a href="../../../index.html">back to Demo list</a></p>
          <div class="box">
            <h2>NOTICE</h2>
            <div class="content">
              This sample depends on the Microsoft Kinect Research SDK to be installed on the system. If you don't have it yet,
              resp. this sample isn't working, ensure to download it here and install it to this system:
              <a href="http://research.microsoft.com/en-us/um/redmond/projects/kinectsdk/download.aspx">Microsoft Kinect SDK</a>
            </div><!--content-->
          </div><!--box-->
          <div class="box">
            <h2>DESCRIPTION</h2>
            <div class="content">
              Kinect Viewer.<br>
              The points in this sample are driven by the depth and color channel of the Kinect Camera.
              The minimum distance the camera can grab is 800mm.
            </div><!--content-->
          </div><!--box-->
                  <div class="box">
                    <h2>CONTROLS</h2>
                    <div class="content">
                      <button id="play">Pause</button>
                    </div><!--content-->
                </div><!--box-->

        </div><!--sidebar-->
      </div> <!--editor-->
    </div><!--wrapper-->
  </body> 
  </html>
